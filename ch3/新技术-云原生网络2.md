---
authors: [""]
company: ["谐云"]
reviewers: [""]
---

在kubernetes已经成为云原生的底座的前提之下，其实云原生网络更多指的是Kubernetes的网络。那么，我们得了解一下Kubernetes架构之前网络是如何运转的。和其他大部分的核心基础组件相同，Kubernetes对于网络的态度也是去集百家之长。CNI只关心容器的网络连接，在容器创建时分配网络资源，并在删除容器时删除分配 的资源。因为这个焦点，CNI有广泛的支持，规格易于实现。CNI接口只需要实现两个方 法，一个创建容器时调用，一个删除容器时调用，其他所有的网络能力都交给网络厂商去增值。

![云原生网络](imgs/云原生网络.png)

### 云原生网络的技术选型
那么，从这些繁多的CNI网络方案中，我们如何去归类和选择呢。因为大部分的用户场景都是基于网络的通讯协议去进行方案选择，因此我们也根据网络的通讯协议不同，大致把网络分为以下三类。

#### 路由模式
- Calico BGP
- Flannel Host Gateway
- Kube-router
- Contiv BGP
#### Overlay
- Calico IPIP,VXLAN
- Flannel VXLAN, UDP
- WEAVE
- Canal
- SDN网络方案，诸如ovn-kubernetes overlay, kube-ovn overlay, contiv overlay等。
####  L2方案
- Lunix Bridge
- Macvlan
- SRIOV
- OVS Bridge
- Contiv Vlan
- Ovn-kubernetes

接下来，我们来探讨下每种网络方案的优势，以及用户在选择时候的需要关注的一些点。
####  路由模式
优势
- 接近于物理机的性能，能够保证高并发的支撑
- 可支持Kubernetes的原生负载均衡和Network Policy机制
- 符合传统网络的监管要求（可与防火墙方案兼容）
不足
- 大规模应用场景，需要跟交换机进行BGP打通
#### Overlay模式
优势
- 对物理网络无侵入，完全的私网模式
- 完美兼容kubernetes的优势，负载均衡以及networkpolicy
不足
- 存在着封装，所以性能和其他网络方案对比较差
- 排查问题困难，需要进行解包封包，需要引入额外的网络排查工具
- 无法和传统的网络监管模式兼容
#### L2模式
优势
- 网络性能高，接近于物理机的性能，有些甚至比主机网络性能还好
- 符合传统网络的监管要求（可与防火墙方案兼容）
- 可直接与iaas网络层通信，易于迁移
不足
- 网络管理依赖于物理网络的模式
- 大部分方案无法复用Kuberentes的网络优势
 

### 云原生网络的发展
从CNI标准的发布到2020年，也已经演进了将近6年的时间。同时，云原生网络也积累了大量的用户落地案例和大规模的实践案例。未来对于云原生网络的演进，还是会朝着用户真正的落地场景方向演进。总结起来主要是以下几个趋势：

#### 落地实践
 
 未来会有越来越多的基于用户大规模实践和解决某些特殊领域问题的网络方案逐步开源。这些开源的网络方案会聚焦在解决客户某些特定场景的问题。比如灵雀开源的kube-ovn以及谐云开源的基于大规模场景下calico应用的HC-Calico都是致力于解决特定场景问题的网络方案。
#### 网络安全
平台的安全问题在所有的平台演进和建设过程中一直扮演着非常重要，但是不十分紧急的角色。因此，在容器安全建设上，大部分组织都是采取防守和被动姿态。但是本身在近几年陆续爆出大量的基于容器平台的安全隐患以及在工信部和网信办联合组织的“护网行动”的大背景之下，容器安全已经成为云原生底座无法绕开的一个问题。 容器网络安全则在整个底座安全里面扮演了非常重要的角色，因此也将成为之后的CNI网络演进的方向和趋势。
#### 网络管理
SDN在大规模网络场景下的应用会越来越突出。在底层网络SDN的趋势之下，容器网络管理作为未来用户第二个网络管理平面，其实更需要SDN的技术应用。SDN本身的两大特点： 1. 网络可编程 2. 数据平面和管理平台分离。首先，用户可以基于这两大特点来进行自己的网络管理平台的开发和编程，和传统的网络管理平面进行便利的兼容和对接。其次，SDN带来的丰富的网络管理功能和细粒度的网络管控，都可以支撑在大规模场景的网络精细化管理。
#### 网络管控
由于容器生命周期短暂，大部分容器网络都是通过地址转换访问非容器业务，容器网络的管控一直是企业面临的难题。在容器访问控制层面，在集群内部，每个物理节点上部署能够感知容器生命周期的代理组件，通过iptables或ebpf实现对容器网络的访问控制；在集群外部，主要通过容器IP地址管理和传统防火墙实现访问控制，市场上也依稀存在能够感知容器网络的新型硬件防火墙。在容器网络监控层面，传统的业务的网络监控耗费了大量的设备和资源，容器网络监控还需要动态的关联容器与业务之间的关系，比传统网络更加重量级。
#### 多网络平面
为了实现容器网络的访问控制，也不牺牲典型容器网络的灵活性，多网络平面的需求也多了起来。多网络平面的默认网卡一般用来当做容器集群的主网卡，负责集群内部的通信；多网络平面会根据业务需求在容器中配置副网卡，能够访问集群外部的其他网络区域，例如将副网卡桥接到物理网络能够便捷的实现固定IP和容器网络向外的访问控制。

