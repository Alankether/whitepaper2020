---
authors: ["赵华"]
company: ["华为"]
reviewers: ["刘如明"]
---
# 6.	有状态中间件应用管理

以容器为代表的云原生技术，用开放、标准的技术体系，帮助企业和开发者在云上构建和运行可弹性扩展、容错性好、易于管理、便于观察的系统，已经成为释放云价值的最短路径。通过声明式API和控制器模式（Controller Pattern），Kubernetes构建出一套“面向终态”的编排体系，已经成为容器编排的事实标准，为用户提供了敏捷、弹性、可移植性等核心价值，被广泛用于自动部署、扩展和管理容器化应用。无状态应用容器化已是非常普遍地现状，但由于中间件应用基本上都是分布式的、有状态的，其生命周期管理比无状态应用会复杂很多。

**Kubernetes现有资源类型无法实现有状态应用的合理抽象与描述，** 有状态应用对外部资源具有一定的绑定性依赖，多个实例之间往往有着拓扑关系，且这些实例本身并不完全等价。Kubernetes内置的StatefulSet资源类型在管理有状态应用方面仅解决了启动顺序、存储状态依赖性，无法实现应用“状态”的合理的抽象与描述，状态和容器进程本身无法解耦；**有状态应用的管理经验无法得到有效沉淀，** 在当前环境下，开发者不得不去尝试编写一套复杂的管理脚本，而这些脚本、知识、和经验，并没有一个很好的办法能够有效的沉淀下来。这一现状制约着云原生应用更广泛的普及。

**面向交付及运维的Operator技术提供了打包、部署、管理Kubernetes应用的全新方式。** Operator一种通过扩展Kubernetes的资源模型，引入自定义控制器，实现对资源及其状态的灵活控制的技术。 Operator把控制器模式的思想贯彻得更加彻底，在CRD基础上加上自定义控制器，实现丰富、可扩展的调度及运维功能。Operator的本质是一段代码，这段代码通过实现Kubernetes的控制器模式，来保证这个CRD资源始终跟用户的定义完全相同，而在这个过程中，Operator也有能力利用Kubernetes的存储、网络插件等外部资源，协同的为应用状态的保持提供帮助。