---
authors: ["赵华"]
company: ["华为"]
reviewers: ["赵华"]
---

# 5.	多云容器编排

企业生产环境容器集群规模爆发式增长，越来越多的企业核心业务切换到容器，容器技术栈需要应对的场景越来越复杂，对多云环境的容器编排能力提出了强烈诉求，主要的场景需求如下：

**避免厂商锁定，** 应用可以灵活地部署在不同云供应商或本地IDC的集群中，不再依赖某一家云服务厂商；**云上云下分离部署，** 部分核心业务部署在私有云环境，满足行业监管和数据安全要求，普通业务部署在公有云上，利用公有云强大的计算能力，同时节约成本；**跨云部署实现容灾，** 在云服务商发生故障时可以快速切换到其他的云服务商或者混合云环境中去，实现业务的容灾管理；**跨云弹性伸缩，** 利用公有云超大资源池应对短期流量高峰场景，大幅提高业务的承载能力。

当前多云容器编排的实现有两种主要实现方式：**以GitOps为媒介联通多云环境的Kubernetes集群进行协作。** GitOps是一种持续交付的理念，其核心思想是将应用系统的声明性基础架构和应用程序存放在Git库中进行版本控制。通过将GitOps与Kubernetes结合，利用自动交付流水线将更改的应用到指定的任意多个集群中。同时，还可通过工具将各集群环境上的实际状态与Git库中的配置做比较，快速发现集群配置的非预期变更，并将其还原到预期的状态，以确保多集群环境配置的一致性，从而达到多云容器编排部署的目的。然而GitOps方案目前只能解决跨云部署的配置一致性问题，而无法解决跨云应用容灾切换、跨云弹性伸缩等高阶业务场景诉求；**通过集群联邦项目扩展资源类型实现跨集群编排调度。** SIG-Federation于2016年正式推出官方项目Federation，并在此基础上发展出了Kubefed项目。Kubefed简化了Federated API的扩展方式，并在跨集群服务发现和编排等方面做了增强。Kubefed通过CRD（Custom Resource Definitions）机制来完成Federated Resources的扩充。联邦控制器则管理这些CRD，负责把资源分发到不同的集群中，并通过 ExternalDNS等服务发现机制打通不同集群的应用访问与协同。KubeFed遵循模块化与可定制的设计理念，并与 K8S生态保持兼容性与扩展性，由此，基于KubeFed的架构理论上可支持扩展解决各类多云场景的问题。